{
  "info": { "name": "Microcourse Auth E2E (raw-only URLs)", "_postman_id": "auth-e2e", "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json" },
  "item": [
    {
      "name": "Login",
      "request": {
        "method": "POST",
        "header": [{ "key":"Content-Type", "value":"application/json" }],
        "url": "{{base}}/api/auth/login",
        "body": { "mode": "raw", "raw": "{ \"email\": \"owner@example.com\", \"password\": \"password\" }" }
      },
      "event": [{
        "listen":"test",
        "script":{ "type":"text/javascript", "exec":[
          "pm.test('Login returned token', () => {",
          "  const j = pm.response.json();",
          "  pm.expect(typeof j.token).to.eql('string');",
          "  pm.collectionVariables.set('token', j.token);",
          "});"
        ]}
      }]
    },
    {
      "name": "WhoAmI",
      "request": {
        "method": "GET",
        "header": [{ "key":"Authorization", "value":"Bearer {{token}}" }],
        "url": "{{base}}/api/auth/whoami"
      },
      "event": [{
        "listen":"test",
        "script":{ "type":"text/javascript", "exec":[
          "pm.test('whoami success true', () => {",
          "  const j = pm.response.json();",
          "  pm.expect(j.success).to.eql(true);",
          "  pm.expect(j.user).to.be.an('object');",
          "});"
        ]}
      }]
    },
    {
      "name": "Ping Protected (primary)",
      "request": {
        "method": "GET",
        "header": [{ "key":"Authorization", "value":"Bearer {{token}}" }],
        "url": "{{base}}/api/auth/ping-protected"
      },
      "event": [{
        "listen":"test",
        "script":{ "type":"text/javascript", "exec":[
          "pm.test('ping primary ok', () => {",
          "  const j = pm.response.json();",
          "  pm.expect(j.success).to.eql(true);",
          "});"
        ]}
      }]
    },
    {
      "name": "Ping Protected (tiny)",
      "request": {
        "method": "GET",
        "header": [{ "key":"Authorization", "value":"Bearer {{token}}" }],
        "url": "{{base}}/tiny/api/auth/ping-protected"
      },
      "event": [{
        "listen":"test",
        "script":{ "type":"text/javascript", "exec":[
          "pm.test('tiny ping ok', () => {",
          "  const j = pm.response.json();",
          "  pm.expect(j.success).to.eql(true);",
          "});"
        ]}
      }]
    }
  ],
  "variable": [{ "key":"base", "value":"http://localhost:10003" }]
}
